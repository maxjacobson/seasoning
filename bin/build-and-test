#!/bin/sh

set -e

bin/rails css:build
bin/rails javascript:build

# Running tests in parallel often fails on macOS
if [ "$(uname)" = "Darwin" ]; then
  export PARALLEL_WORKERS=1
fi
export HEADLESS=1
export COVERAGE=1
export RUBYOPT="--enable=frozen-string-literal --debug=frozen-string-literal"

bin/rails test:all
