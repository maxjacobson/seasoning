<% content_for :title, "#{@show.title} - #{@season.name} Review" %>

<div class="bg-white rounded-lg shadow-md p-6 max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold text-gray-900 mb-2"><%= @show.title %></h1>

  <h2 class="text-xl text-gray-700 mb-6"><%= @season.name %></h2>

  <div class="text-gray-600 mb-4">
    <%= link_to @author.handle, human_profile_path(@author.handle) %> &rsquo;s
    review of
    <%= link_to @season.name, season_path(@show.slug, @season.slug) %> of
    <%= link_to @show.title, show_path(@show.slug) %>.
  </div>

  <div class="flex gap-6">
    <div class="flex-shrink-0">
      <h3 class="text-lg font-medium text-gray-900 mb-2">Poster</h3>
      <%= render "poster", show: @show, url: @season.poster.url, size: "large" %>
    </div>

    <div class="flex-1 space-y-4">
      <div>
        <h3 class="text-lg font-medium text-gray-900 mb-1">Date</h3>

        <span class="text-gray-600">
          <%= l(@review.created_at.to_date, format: :default) %>

          <% if @review.viewable_by_only_me? %>
            <span title="Private review - only you can see this">ðŸ”’</span>
          <% end %>
        </span>
      </div>

      <% if @review.rating %>
        <div>
          <h3 class="text-lg font-medium text-gray-900 mb-1">Rating</h3>
          <%= render "star_rating", rating: @review.rating %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-6">
    <h3 class="text-lg font-medium text-gray-900 mb-3">Review</h3>

    <div class="prose max-w-none">
      <%= auto_link(markdown_to_html(@review.body)).html_safe %>
    </div>
  </div>

  <% if current_human && @review.author == current_human %>
    <div class="flex gap-2">
      <% if @review.viewing == 1 %>
        <%= link_to "Edit review",
            profile_edit_season_review_path(@author.handle, @show.slug, @season.slug),
            class: "rounded-button" %>
        <%= button_to "Delete review",
            profile_season_review_path(@author.handle, @show.slug, @season.slug),
            method: :delete,
            class: "rounded-button",
            data: { turbo_confirm: "Are you sure you want to delete this review? This cannot be undone." } %>
      <% else %>
        <%= link_to "Edit review",
            profile_edit_season_review_viewing_path(@author.handle, @show.slug, @season.slug, @review.viewing),
            class: "rounded-button" %>
        <%= button_to "Delete review",
            profile_season_review_viewing_path(@author.handle, @show.slug, @season.slug, @review.viewing),
            method: :delete,
            class: "rounded-button",
            data: { turbo_confirm: "Are you sure you want to delete this review? This cannot be undone." } %>
      <% end %>
    </div>
  <% end %>
</div>
