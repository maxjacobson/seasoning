<%= content_for :title do %>
  <%= @show.title %> - <%= @season.name %>
<% end %>

<h1 class="text-xl"><%= @show.title %></h1>
<h2 class="text-lg"><%= @season.name %></h2>

<%= render "more_info", url: "https://www.themoviedb.org/tv/#{@show.tmdb_tv_id}/season/#{@season.season_number}" %>

<p><%= link_to "Back", show_path(@show.slug) %></p>

<%= render "poster", size: "large", show: @show, url: @season.poster.url %>

<h2 class="text-lg">Season info</h2>

<table class="w-full">
  <thead>
    <tr>
      <th class="text-left">Number</th>
      <th class="text-left">Name</th>
      <th class="text-left">Air date</th>
      <% if current_human %>
        <th class="text-left">Seen?</th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @season.episodes.each do |episode| %>
      <tr>
        <td><%= episode.episode_number %></td>
        <td>
          <%= link_to episode.name, season_episode_show_path(@show.slug, @season.slug, episode.episode_number) %>
        </td>
        <td>
          <%= render "air_date", episode: episode %>
        </td>
        <% if current_human %>
          <td>
            <% if @my_season && @my_season.watched_episode_numbers.include?(episode.episode_number) %>
              ✅ <%= button_to "Unwatch", update_season_show_path(@show.slug, @season.slug), method: :patch, class: "rounded-button mb-1", params: { unwatched: episode.episode_number }, form_class: "inline" %>
            <% else %>
              ❌ <%= button_to "Watch", update_season_show_path(@show.slug, @season.slug), method: :patch, class: "rounded-button mb-1", params: { watched: episode.episode_number }, form_class: "inline" %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<% if current_human %>
  <h2 class="text-lg">Your review(s)</h2>
  <%= link_to "Add review", new_review_show_path(@show.slug, @season.slug), class: "underlined" %>

  <% if (reviews = current_human.reviews_for(@season)).any? %>
    <ul>
      <% reviews.each do |review| %>
        <li><%= link_to review.created_at, proper_review_path(review) %></li>
      <% end %>
    </ul>
  <% else %>
    <p>None yet!</p>
  <% end %>
<% end %>

<%= render "show_metadata", show: @show %>
